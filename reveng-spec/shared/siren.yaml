# This file contains detailed schemas for the various Siren entity structures
# returned by the Brightspace and D2L APIs.

components:
  schemas:
    # --------------------------------------------------------------------------
    # Base Siren Schemas
    # --------------------------------------------------------------------------
    SirenEntity:
      type: object
      description: "A generic Siren hypermedia entity. The structure of properties and sub-entities depends on the specific resource."
      properties:
        class:
          type: array
          items:
            type: string
        properties:
          type: object
        entities:
          type: array
          items:
            $ref: "#/components/schemas/SirenEntity"
        links:
          type: array
          items:
            $ref: "#/components/schemas/SirenLink"
        actions:
          type: array
          items:
            $ref: "#/components/schemas/SirenAction"
        href:
          type: string
          format: uri
        rel:
          type: array
          items:
            type: string

    SirenLink:
      type: object
      required:
        - rel
        - href
      properties:
        class:
          type: array
          items:
            type: string
        rel:
          type: array
          items:
            type: string
        href:
          type: string
          format: uri
        title:
          type: string
        type:
          type: string

    SirenAction:
      type: object
      required:
        - name
        - href
      properties:
        name:
          type: string
        title:
          type: string
        method:
          type: string
          enum: [GET, POST, PUT, DELETE, PATCH]
          default: GET
        href:
          type: string
          format: uri
        type:
          type: string
        class:
          type: array
          items:
            type: string
        fields:
          type: array
          items:
            $ref: "#/components/schemas/SirenActionField"

    SirenActionField:
      type: object
      required:
        - name
        - type
      properties:
        name:
          type: string
        type:
          type: string
          enum: [hidden, text, search, tel, url, email, password, datetime, date, month, week, time, datetime-local, number, range, color, checkbox, radio, file]
          default: text
        value:
          type: object
        title:
          type: string

    # --------------------------------------------------------------------------
    # Enrollments API Schemas
    # --------------------------------------------------------------------------

    UserEnrollmentsEntity:
      description: "A Siren entity representing a user's enrollments. Returned by `GET /users/{userId}` on the `enrollments` subdomain."
      type: object
      required:
        - class
        - entities
        - links
      properties:
        class:
          type: array
          items:
            type: string
          example: ["enrollments", "collection"]
        entities:
          type: array
          items:
            $ref: "#/components/schemas/EnrollmentSubEntity"
        links:
          type: array
          items:
            $ref: "#/components/schemas/SirenLink"
          description: "Contains self, next (if paginated), organization, departments, and semesters links."
        actions:
          type: array
          items:
            $ref: "#/components/schemas/SirenAction"
          description: "Filter actions for departments, semesters, and search."

    EnrollmentSubEntity:
      description: "A sub-entity within the UserEnrollmentsEntity, representing a single course enrollment."
      type: object
      required:
        - class
        - rel
        - href
      properties:
        class:
          type: array
          items:
            type: string
          example: ["enrollment", "unpinned"]
        rel:
          type: array
          items:
            type: string
          example: ["https://api.brightspace.com/rels/user-enrollment"]
        href:
          type: string
          format: uri
          description: "Link to the full EnrollmentDetailEntity."

    EnrollmentDetailEntity:
      description: "Detailed enrollment information, including organization links and actions."
      type: object
      required:
        - class
        - links
      properties:
        class:
          type: array
          items:
            type: string
          example: ["enrollment", "unpinned"]
        links:
          type: array
          items:
            $ref: "#/components/schemas/SirenLink"
          description: "Contains self, organization, folio, grades, user, etc."
        actions:
          type: array
          items:
            $ref: "#/components/schemas/SirenAction"
          description: "Actions like pin-course."
        rel:
          type: array
          items:
            type: string

    # --------------------------------------------------------------------------
    # Organizations API Schemas
    # --------------------------------------------------------------------------

    OrganizationEntity:
      description: "Organization entity representing a school, department, semester, or course."
      type: object
      required:
        - class
        - properties
        - links
      properties:
        class:
          type: array
          items:
            type: string
          example: ["course-offering", "organization"]
        properties:
          type: object
          properties:
            name:
              type: string
              description: "The display name of the organization."
            code:
              type: string
              nullable: true
              description: "The organization code (e.g., course code)."
            homepageUrl:
              type: string
              format: uri
              nullable: true
          required:
            - name
        entities:
          type: array
          items:
            oneOf:
              - $ref: "#/components/schemas/CourseImageLinkEntity"
              - $ref: "#/components/schemas/EnrollmentSubEntity"
        links:
          type: array
          items:
            $ref: "#/components/schemas/SirenLink"
          description: "Contains self link."

    CourseImageLinkEntity:
      description: "A sub-entity that links to a CourseImageEntity."
      type: object
      required:
        - class
        - rel
        - href
      properties:
        class:
          type: array
          items:
            type: string
          example: ["course-image"]
        rel:
          type: array
          items:
            type: string
          example: ["https://api.brightspace.com/rels/course-image"]
        href:
          type: string
          format: uri
          description: "A link to the CourseImageEntity."

    CourseImageEntity:
      description: "An entity that contains links to the actual course image URLs in various sizes."
      type: object
      required:
        - class
        - links
      properties:
        class:
          type: array
          items:
            type: string
          example: ["course-image"]
        links:
          type: array
          items:
            $ref: "#/components/schemas/SirenLink"
          description: "Contains links to image files. The client looks for specific classes like ['banner', 'wide', 'max'] or ['tile', 'mid']."

    # --------------------------------------------------------------------------
    # Sequences API Schemas
    # --------------------------------------------------------------------------

    ModuleSequenceEntity:
      description: "The root entity for a module's content, returned by `GET /{moduleId}` on the sequences API. It contains a tree of folders and activities."
      type: object
      required:
        - class
        - properties
        - entities
      properties:
        class:
          type: array
          items:
            type: string
          example: ["sequence", "sequence-description"]
        properties:
          type: object
          properties:
            title:
              type: string
              description: "The module title."
            pagingInfo:
              type: object
              nullable: true
            courseName:
              type: string
            canDownload:
              type: boolean
            canPrint:
              type: boolean
            sideNavOpen:
              type: boolean
            variableModuleDepth:
              type: boolean
            maxModuleDisplayDepth:
              type: integer
        entities:
          type: array
          items:
            $ref: "#/components/schemas/SequenceNodeEntity"
          description: "Contains child nodes (folders or activities)."

    SequenceNodeEntity:
      description: "Represents a node in the module content sequence tree. It can be a folder or an activity."
      oneOf:
        - $ref: "#/components/schemas/SequenceFolderEntity"
        - $ref: "#/components/schemas/SequencedActivityEntity"

    SequenceFolderEntity:
      description: "A folder (or 'unit') in the module content sequence."
      type: object
      required:
        - class
        - properties
      properties:
        class:
          type: array
          items:
            type: string
          example: ["release-condition-fix", "sequence", "sequence-description"]
        properties:
          type: object
          required:
            - title
          properties:
            title:
              type: string
              description: "The folder title."
            description:
              type: string
              description: "HTML description of the folder."
            courseName:
              type: string
            canDownload:
              type: boolean
            canPrint:
              type: boolean
            sideNavOpen:
              type: boolean
        entities:
          type: array
          items:
            $ref: "#/components/schemas/SequenceNodeEntity"
          description: "Contains child nodes (folders or activities)."

    SequencedActivityEntity:
      description: "An activity reference within the module content sequence. The actual activity details are embedded as sub-entities."
      type: object
      required:
        - class
        - rel
        - properties
        - entities
      properties:
        class:
          type: array
          items:
            type: string
          example: ["release-condition-fix", "sequenced-activity"]
        rel:
          type: array
          items:
            type: string
          example: ["item"]
        properties:
          type: object
          required:
            - title
          properties:
            title:
              type: string
              description: "The activity title."
            courseName:
              type: string
            canDownload:
              type: boolean
            canPrint:
              type: boolean
            enableManualCompletionComponent:
              type: boolean
        entities:
          type: array
          items:
            oneOf:
              - $ref: "#/components/schemas/IconEntity"
              - $ref: "#/components/schemas/ActivitySubEntity"
          description: "Contains icon entities and the activity sub-entity."
        links:
          type: array
          items:
            $ref: "#/components/schemas/SirenLink"
          description: "Contains organization, sequence-root, and alternate links."

    ActivityEntity:
      description: "Full activity details returned by `GET /{moduleId}/activity/{activityId}`."
      type: object
      required:
        - class
        - properties
        - entities
        - links
      properties:
        class:
          type: array
          items:
            type: string
          example: ["release-condition-fix", "sequenced-activity"]
        properties:
          type: object
          properties:
            title:
              type: string
            courseName:
              type: string
            canDownload:
              type: boolean
            canPrint:
              type: boolean
            enableManualCompletionComponent:
              type: boolean
        entities:
          type: array
          items:
            oneOf:
              - $ref: "#/components/schemas/IconEntity"
              - $ref: "#/components/schemas/ActivitySubEntity"
              - $ref: "#/components/schemas/CompletionEntity"
              - $ref: "#/components/schemas/LastViewedEntity"
        links:
          type: array
          items:
            $ref: "#/components/schemas/SirenLink"
        actions:
          type: array
          items:
            $ref: "#/components/schemas/SirenAction"

    IconEntity:
      description: "Icon entity representing the activity icon."
      type: object
      required:
        - class
        - rel
        - properties
      properties:
        class:
          type: array
          items:
            type: string
          example: ["icon", "tier1"]
        rel:
          type: array
          items:
            type: string
          example: ["icon"]
        properties:
          type: object
          properties:
            iconSetKey:
              type: string
              example: "tier1:browser"
            imagePath:
              type: string
              format: uri

    ActivitySubEntity:
      description: "The specific activity type details (file, link, content-service, etc.)."
      type: object
      required:
        - class
        - rel
        - properties
      properties:
        class:
          type: array
          items:
            type: string
          example: ["activity", "file-activity"]
        rel:
          type: array
          items:
            type: string
          example: ["about"]
        properties:
          type: object
          properties:
            name:
              type: string
            title:
              type: string
            canDownload:
              type: boolean
            canPrint:
              type: boolean
        entities:
          type: array
          items:
            oneOf:
              - $ref: "#/components/schemas/FileSubEntity"
              - $ref: "#/components/schemas/LastModifiedEntity"
              - $ref: "#/components/schemas/CompletionEntity"
        actions:
          type: array
          items:
            $ref: "#/components/schemas/SirenAction"

    FileSubEntity:
      description: "The actual file entity within a FileActivityEntity."
      type: object
      required:
        - class
        - rel
        - properties
        - links
      properties:
        class:
          type: array
          items:
            type: string
          example: ["file"]
        rel:
          type: array
          items:
            type: string
          example: ["about"]
        properties:
          type: object
          properties:
            name:
              type: string
            title:
              type: string
            type:
              type: string
              description: "The MIME type of the file."
              example: "text/html"
            canDownload:
              type: boolean
            canPrint:
              type: boolean
        entities:
          type: array
          items:
            $ref: "#/components/schemas/LastModifiedEntity"
        links:
          type: array
          items:
            $ref: "#/components/schemas/SirenLink"
          description: "Contains alternate, embed, view, fullscreen, and download links."

    LastModifiedEntity:
      description: "Last modified date entity."
      type: object
      required:
        - class
        - rel
        - properties
      properties:
        class:
          type: array
          items:
            type: string
          example: ["last-modified", "date"]
        rel:
          type: array
          items:
            type: string
          example: ["item"]
        properties:
          type: object
          properties:
            date:
              type: string
              format: date-time

    LastViewedEntity:
      description: "Last viewed date entity."
      type: object
      required:
        - class
        - rel
        - properties
      properties:
        class:
          type: array
          items:
            type: string
          example: ["last-viewed", "date"]
        rel:
          type: array
          items:
            type: string
          example: ["item"]
        properties:
          type: object
          properties:
            date:
              type: string
              format: date-time

    CompletionEntity:
      description: "Completion status entity."
      type: object
      required:
        - class
        - rel
      properties:
        class:
          type: array
          items:
            type: string
          example: ["completion", "completed", "required"]
        rel:
          type: array
          items:
            type: string
          example: ["item", "https://api.brightspace.com/rels/completion"]
        entities:
          type: array
          items:
            $ref: "#/components/schemas/CompletionDateEntity"

    CompletionDateEntity:
      description: "Completion date sub-entity."
      type: object
      required:
        - class
        - rel
        - properties
      properties:
        class:
          type: array
          items:
            type: string
          example: ["auto", "completion", "date"]
        rel:
          type: array
          items:
            type: string
          example: ["item"]
        properties:
          type: object
          properties:
            date:
              type: string
              format: date-time

    # --------------------------------------------------------------------------
    # Activities API Schemas (Dropbox/Assignments)
    # --------------------------------------------------------------------------

    UserAssignmentActivityEntity:
      description: "User assignment activity entity returned by the activities API. Contains submission status and links."
      type: object
      required:
        - class
        - entities
        - links
      properties:
        class:
          type: array
          items:
            type: string
          example: ["user-assignment-activity", "activity", "started"]
        entities:
          type: array
          items:
            oneOf:
              - $ref: "#/components/schemas/AssignmentSubmissionListEntity"
              - $ref: "#/components/schemas/DateEntity"
              - $ref: "#/components/schemas/AvailabilityDatesEntity"
              - $ref: "#/components/schemas/CompletionEntity"
              - $ref: "#/components/schemas/RelativeUriEntity"
        links:
          type: array
          items:
            $ref: "#/components/schemas/SirenLink"
          description: "Contains user-activity-usage (self), activity-usage, user, organization, evaluation, associations, assignment, feedback links."
        actions:
          type: array
          items:
            $ref: "#/components/schemas/SirenAction"
          description: "Actions like query-associations and submit."

    AssignmentSubmissionListEntity:
      description: "List of assignment submissions for a user."
      type: object
      required:
        - class
        - rel
        - properties
        - links
      properties:
        class:
          type: array
          items:
            type: string
          example: ["assignment-submission-list"]
        rel:
          type: array
          items:
            type: string
          example: ["https://assignments.api.brightspace.com/rels/assignment-submission-list"]
        properties:
          type: object
          properties:
            downloadAll:
              type: string
              description: "Path to download all submissions."
        links:
          type: array
          items:
            $ref: "#/components/schemas/SirenLink"
          description: "Links to individual assignment submissions."

    AssignmentSubmissionEntity:
      description: "Individual assignment submission details."
      type: object
      required:
        - class
        - properties
        - entities
        - links
      properties:
        class:
          type: array
          items:
            type: string
          example: ["assignment-submission"]
        properties:
          type: object
          properties:
            submissionNumber:
              type: integer
            evaluationStatus:
              type: string
              enum: ["Evaluated", "Pending", "NotEvaluated"]
        entities:
          type: array
          items:
            oneOf:
              - $ref: "#/components/schemas/AttachmentListEntity"
              - $ref: "#/components/schemas/DateEntity"
              - $ref: "#/components/schemas/RelativeUriEntity"
        links:
          type: array
          items:
            $ref: "#/components/schemas/SirenLink"
          description: "Contains self and user links."

    AttachmentListEntity:
      description: "List of file attachments in a submission."
      type: object
      required:
        - class
        - rel
        - entities
      properties:
        class:
          type: array
          items:
            type: string
          example: ["attachment-list"]
        rel:
          type: array
          items:
            type: string
          example: ["https://assignments.api.brightspace.com/rels/attachment-list"]
        entities:
          type: array
          items:
            $ref: "#/components/schemas/AttachmentEntity"

    AttachmentEntity:
      description: "Individual file attachment."
      type: object
      required:
        - class
        - rel
        - properties
        - links
      properties:
        class:
          type: array
          items:
            type: string
          example: ["attachment"]
        rel:
          type: array
          items:
            type: string
          example: ["https://assignments.api.brightspace.com/rels/attachment"]
        properties:
          type: object
          properties:
            id:
              type: string
            name:
              type: string
            size:
              type: integer
            extension:
              type: string
            flagged:
              type: boolean
            read:
              type: boolean
            href:
              type: string
              format: uri
            fileViewer:
              type: string
              format: uri
            downloadHref:
              type: string
              format: uri
        links:
          type: array
          items:
            $ref: "#/components/schemas/SirenLink"
          description: "Contains alternate and annotated links."

    DateEntity:
      description: "Generic date entity."
      type: object
      required:
        - class
        - rel
        - properties
      properties:
        class:
          type: array
          items:
            type: string
          example: ["date", "submission-date"]
        rel:
          type: array
          items:
            type: string
          example: ["https://api.brightspace.com/rels/date"]
        properties:
          type: object
          properties:
            date:
              type: string
              format: date-time
            localizedDate:
              type: string
              nullable: true

    AvailabilityDatesEntity:
      description: "Assignment availability dates entity."
      type: object
      required:
        - class
        - rel
        - properties
        - entities
      properties:
        class:
          type: array
          items:
            type: string
          example: ["availability-dates"]
        rel:
          type: array
          items:
            type: string
          example: ["https://api.brightspace.com/rels/availabilitydates"]
        properties:
          type: object
          properties:
            CurrentAvailabilityType:
              type: integer
            DisplayInCalendar:
              type: boolean
        entities:
          type: array
          items:
            $ref: "#/components/schemas/AvailabilityDateEntity"

    AvailabilityDateEntity:
      description: "Single availability date (start or end)."
      type: object
      required:
        - class
        - rel
        - properties
      properties:
        class:
          type: array
          items:
            type: string
          example: ["availability-start-date", "availability-dates"]
        rel:
          type: array
          items:
            type: string
          example: ["https://api.brightspace.com/rels/availabilitydate"]
        properties:
          type: object
          properties:
            dateTime:
              type: object
              properties:
                date:
                  type: string
                  format: date-time
                localizedDate:
                  type: string
            availabilityType:
              type: integer

    RelativeUriEntity:
      description: "Entity containing a relative URI path."
      type: object
      required:
        - class
        - rel
        - properties
      properties:
        class:
          type: array
          items:
            type: string
          example: ["relative-uri"]
        rel:
          type: array
          items:
            type: string
          example: ["https://assessments.api.brightspace.com/rels/assessment-rubric-application"]
        properties:
          type: object
          properties:
            path:
              type: string

    # --------------------------------------------------------------------------
    # Content Service API Schemas
    # --------------------------------------------------------------------------

    ContentServiceTopicEntity:
      description: "Content service topic entity, returned by `GET /topics/{moduleId}/{activityId}`. Contains thumbnail information."
      type: object
      required:
        - class
        - entities
        - links
      properties:
        class:
          type: array
          items:
            type: string
          example: ["topic", "content-service"]
        entities:
          type: array
          items:
            $ref: "#/components/schemas/ThumbnailEntity"
        links:
          type: array
          items:
            $ref: "#/components/schemas/SirenLink"

    ThumbnailEntity:
      description: "Thumbnail image entity."
      type: object
      required:
        - class
        - rel
        - properties
      properties:
        class:
          type: array
          items:
            type: string
          example: ["thumbnail"]
        rel:
          type: array
          items:
            type: string
          example: ["item"]
        properties:
          type: object
          properties:
            src:
              type: string
              format: uri
            expires:
              type: integer
              description: "Unix timestamp when the URL expires."

    ContentServiceMediaEntity:
      description: "Content service media entity, returned by `GET /topics/{moduleId}/{activityId}/media`. Contains the media source URL."
      type: object
      required:
        - class
        - properties
      properties:
        class:
          type: array
          items:
            type: string
          example: ["media", "content-service"]
        properties:
          type: object
          required:
            - src
          properties:
            src:
              type: string
              format: uri
              description: "The URL to the media file. May have an expiry time."

    # --------------------------------------------------------------------------
    # Legacy / Deprecated schemas (for backwards compatibility)
    # --------------------------------------------------------------------------

    SemesterListEntity:
      description: "A Siren entity returned by the D2L `courses-searches` endpoint. The semesters are in the `actions` array."
      allOf:
        - $ref: "#/components/schemas/SirenEntity"
        - type: object
          properties:
            actions:
              type: array
              items:
                type: object
                properties:
                  name:
                    type: string
                    description: "The ID of the semester."
                  title:
                    type: string
                    description: "The name of the semester."
