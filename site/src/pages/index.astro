---
import { ScalarComponent } from "@scalar/astro";
import { bundle } from "@scalar/json-magic/bundle";
import { readFiles } from "@scalar/json-magic/bundle/plugins/node";
import type { OpenAPI } from "@scalar/openapi-types";
import { glob } from "fs/promises";
import { resolve, dirname } from "node:path";
import { fileURLToPath } from "node:url";

const specDir = resolve(dirname(fileURLToPath(import.meta.url)), "../../../reveng-spec");
const fileIter = glob("**/*.yaml", { cwd: specDir, exclude: ["**/shared/**/*"] });
const sources = [];

for await (const file of fileIter) {
  const result: OpenAPI.Document = await bundle(resolve(specDir, file), { plugins: [readFiles()], treeShake: true });
  sources.push({ content: JSON.stringify(result), title: result.info.title });
}
---

<ScalarComponent configuration={{ pageTitle: "POLITEMall API | POLITEShop", sources }} />
